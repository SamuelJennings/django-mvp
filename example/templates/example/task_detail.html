{% extends "layouts/standard.html" %}
{% load humanize %}
{% block title %}
  {{ task.title }}
{% endblock title %}
{% block page_title %}
  {{ task.title }}
{% endblock page_title %}
{% block content %}
  <div class="row">
    {# Main task details #}
    <div class="col-lg-8">
      <c-card class="mb-4">
        <c-slot name="header">
          <h3 class="mb-0">Task Details</h3>
        </c-slot>
        {# Status badges #}
        <div class="mb-4">
          <span class="badge bg-{% if task.status == 'done' %}success{% elif task.status == 'in_progress' %}warning{% elif task.status == 'review' %}info{% else %}secondary{% endif %} fs-6 me-2">
            {{ task.get_status_display }}
          </span>
          <span class="badge bg-{% if task.priority == 'urgent' %}danger{% elif task.priority == 'high' %}warning{% elif task.priority == 'medium' %}info{% else %}secondary{% endif %} fs-6">
            {{ task.get_priority_display }} Priority
          </span>
          {% if task.is_overdue %}<span class="badge bg-danger fs-6 ms-2">Overdue</span>{% endif %}
        </div>
        {# Description #}
        {% if task.description %}
          <div class="mb-4">
            <h5>Description</h5>
            <p>{{ task.description|linebreaks }}</p>
          </div>
        {% endif %}
        {# Task metadata #}
        <div class="row g-3 mb-4">
          <div class="col-md-6">
            <c-card class="bg-light">
              <h6 class="text-muted mb-2">Assignee</h6>
              {% if task.assignee %}
                <div>
                  <i class="bi bi-person-circle"></i> <strong>{{ task.assignee }}</strong>
                </div>
              {% else %}
                <span class="text-muted">Unassigned</span>
              {% endif %}
            </c-card>
          </div>
          <div class="col-md-6">
            <c-card class="bg-light">
              <h6 class="text-muted mb-2">Due Date</h6>
              {% if task.due_date %}
                <div>
                  <i class="bi bi-calendar-event"></i>
                  <strong>{{ task.due_date|date:"F j, Y" }}</strong>
                  {% if task.is_overdue %}<span class="text-danger ms-2">(Overdue)</span>{% endif %}
                </div>
              {% else %}
                <span class="text-muted">No due date set</span>
              {% endif %}
            </c-card>
          </div>
        </div>
        {# Time tracking #}
        <div class="mb-4">
          <h5>Time Tracking</h5>
          <table class="table table-sm">
            <tbody>
              <tr>
                <th style="width: 200px;">Estimated Hours</th>
                <td>
                  {% if task.estimated_hours %}
                    {{ task.estimated_hours }} hours
                  {% else %}
                    <span class="text-muted">Not estimated</span>
                  {% endif %}
                </td>
              </tr>
              <tr>
                <th>Actual Hours</th>
                <td>
                  {% if task.actual_hours %}
                    {{ task.actual_hours }} hours
                    {% if task.estimated_hours %}
                      <span class="ms-2 {% if task.actual_hours > task.estimated_hours %}text-danger{% else %}text-success{% endif %}">
                        ({% widthratio task.actual_hours task.estimated_hours 100 %}% of estimate)
                      </span>
                    {% endif %}
                  {% else %}
                    <span class="text-muted">Not tracked</span>
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        {# Dates #}
        <div class="mb-4">
          <h5>Timeline</h5>
          <table class="table table-sm">
            <tbody>
              <tr>
                <th style="width: 200px;">Created</th>
                <td>{{ task.created_at|date:"F j, Y g:i A" }} ({{ task.created_at|naturaltime }})</td>
              </tr>
              <tr>
                <th>Last Updated</th>
                <td>{{ task.updated_at|date:"F j, Y g:i A" }} ({{ task.updated_at|naturaltime }})</td>
              </tr>
              {% if task.completed_at %}
                <tr>
                  <th>Completed</th>
                  <td>{{ task.completed_at|date:"F j, Y g:i A" }} ({{ task.completed_at|naturaltime }})</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
        {# Action buttons #}
        <div class="d-flex gap-2">
          <a href="{% url 'task_list' %}"
             class="btn btn-outline-secondary">â† Back to Tasks</a>
          <button class="btn btn-primary">Edit Task</button>
          {% if task.status != 'done' %}<button class="btn btn-success">Mark as Done</button>{% endif %}
        </div>
      </c-card>
    </div>
    {# Sidebar #}
    <div class="col-lg-4">
      {# Category #}
      {% if task.category %}
        <c-card class="mb-4">
          <c-slot name="header">
            <h5 class="mb-0">Category</h5>
          </c-slot>
          <h6>
            <i class="bi bi-{{ task.category.icon }}"></i>
            {{ task.category.name }}
          </h6>
          <p class="text-muted mb-0">{{ task.category.description }}</p>
        </c-card>
      {% endif %}
      {# Quick stats #}
      <c-card>
        <c-slot name="header">
          <h5 class="mb-0">Quick Stats</h5>
        </c-slot>
        <dl class="row mb-0">
          <dt class="col-6">Status:</dt>
          <dd class="col-6 text-end">
            <span class="badge bg-{% if task.status == 'done' %}success{% else %}secondary{% endif %}">
              {{ task.get_status_display }}
            </span>
          </dd>
          <dt class="col-6">Priority:</dt>
          <dd class="col-6 text-end">
            <span class="badge bg-{% if task.priority == 'urgent' %}danger{% elif task.priority == 'high' %}warning{% else %}secondary{% endif %}">
              {{ task.get_priority_display }}
            </span>
          </dd>
          {% if task.due_date %}
            <dt class="col-6">Days Until Due:</dt>
            <dd class="col-6 text-end">
              {{ task.due_date|timeuntil }}
            </dd>
          {% endif %}
        </dl>
      </c-card>
    </div>
  </div>
{% endblock content %}
