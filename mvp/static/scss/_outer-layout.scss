/* =============================================================================
   OUTER LAYOUT (Application Shell) - Level 1
   
   Structure:
   - .app-shell: Root layout container (100vh flex container)
   - .site-sidebar: Site navigation sidebar (collapsible, offcanvas on mobile)
   - .app-column: Main column containing navbar, content, and footer
   - .site-navbar: Top navigation bar
   - .app-main: Primary content container
   - .app-footer: Application footer
   
   Note: Old class names (.sidebar-layout, .main-column, .main-content) are
   aliased in _backwards-compat.scss for migration period
   ============================================================================= */

/* Application Shell
   Root container for the entire application layout
   --------------------------------------------------------------------------- */
.app-shell {
  height: 100vh;
  display: flex;
  overflow: hidden;

  /* Main column containing all content except site sidebar */
  > .app-column {
    display: flex;
    flex-direction: column;
    flex: 1;
    overflow: hidden;
    min-width: 0; /* Prevent flex overflow */
  }

  /* Responsive sidebar behavior
     Generate classes like .hide-sidebar-lg for each breakpoint
     --------------------------------------------------------------------------- */
  @each $name, $size in $grid-breakpoints {
    &.hide-sidebar-#{$name} {
      > .site-sidebar {
        @extend .offcanvas-#{$name} !optional;
      }

      /* Sidebar Visibility Utilities
         Scoped to only affect direct structural children
         --------------------------------------------------------------------------- */

      /* Hide element when sidebar is offcanvas (below breakpoint)
         Usage: navbar menu items that should hide on mobile */
      > .site-sidebar, > .app-column {
          .hide-if-sidebar-hidden {
            @media (max-width: ($size - 1px)) {
              display: none !important;
            }
          }
      }

      /* Show element only when sidebar is offcanvas (below breakpoint)
         Usage: hamburger buttons that should only show on mobile */
      > .site-sidebar .show-if-sidebar-hidden,
      > .app-column #page-navbar .show-if-sidebar-hidden {
        display: none !important;

        @media (max-width: ($size - 1px)) {
          display: block !important;
        }
      }

      /* Hide element when sidebar is in-flow (above breakpoint)
         Show element when sidebar is offcanvas (below breakpoint)
         Usage: offcanvas dismiss buttons inside sidebar */
      > .site-sidebar .hide-if-sidebar-visible,
      > .app-column #page-navbar .hide-if-sidebar-visible {
        /* Hide above breakpoint (when sidebar is in-flow) */
        @media (min-width: $size) {
          display: none !important;
        }

        /* Show below breakpoint (when sidebar is offcanvas) */
        @media (max-width: ($size - 1px)) {
          display: block !important;
        }
      }
    }
  }
}

/* Layout Mode Specific Styles
   Control sidebar visibility based on configuration
   --------------------------------------------------------------------------- */

/* Navbar-only mode: Sidebar always offcanvas (show_at is False/None) */
body.navbar-only {
  .app-shell > .site-sidebar {
    @extend .offcanvas;
    @extend .offcanvas-start;
  }
  
  /* Always show hamburger menu button in navbar-only mode */
  .app-column #page-navbar .show-if-sidebar-hidden {
    display: block !important;
  }
  
  /* Always hide sidebar-specific elements that only make sense when visible */
  .site-sidebar .hide-if-sidebar-hidden {
    display: none !important;
  }
}

/* Sidebar responsive modes: sidebar-at-{breakpoint} */
/* Behavior is controlled by .hide-sidebar-{breakpoint} classes on .app-shell */
body[class*="sidebar-at-"] {
  /* No additional styling needed - responsive behavior handled by hide-sidebar-* */
}

/* Main Content Container
   Primary scrollable content area within .app-column
   --------------------------------------------------------------------------- */
.app-main {
  flex: 1 1 auto;
  overflow: auto;
  display: flex;
  flex-direction: column;
}

/* Site Navbar
   Top navigation bar (when using navbar layout or both layout)
   --------------------------------------------------------------------------- */
.site-navbar {
  flex-shrink: 0;
  /* Additional navbar styles in _navbar.scss */
}

/* Backwards Compatibility Support
   Support old .sidebar class in outer layout context
   --------------------------------------------------------------------------- */
.app-shell {
  /* Support both .site-sidebar and .sidebar in outer layout */
  > .sidebar:not(.content-sidebar-left):not(.content-sidebar-right) {
    /* This is a site-level sidebar, not a content sidebar */
    @extend .site-sidebar;
  }
}

/* CSS Variables for Outer Layout
   --------------------------------------------------------------------------- */
:root {
  --app-shell-height: 100vh;
  --app-column-min-width: 0;
}
